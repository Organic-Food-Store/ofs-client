<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="app-theme.html">
<dom-module id="food-card">
    <style include="app-theme">
        :host {
            --show-food-card: inline-block;
            display: var(--show-food-card);
        }

        paper-card {
            margin: 12.5px;
            width: 95%;
            max-width: 300px;
            padding-bottom: 12px;
            text-align: center;
        }

        @media only screen and (max-width: 565px) {
            .smallify {
                width: 26px;
                padding: 1px;
            }

            #mainTitle {
                margin-left: 2px;
            }
        }

        paper-input {
            margin: 0px 25px;
        }
    </style>
    <template>
        <firebase-document
            path="/users/[[userId]]/cart/[[storeId]]/[[item.id]]"
            data="{{quanta}}">
        </firebase-document>
        <paper-card image="./../images/food/[[item.id]].png">
            <p>[[capitalize(item.id)]]: [[capitalize(item.description)]]</p>
            <p>Category: [[capitalize(item.category)]]</p>
            <p>[[item.quantity]] in stock per $[[item.price]] each</p>
            <paper-input
                auto-validate
                prevent-invalid-input
                label="Quantity to Buy"
                error-message="We don't have that much stock!"
                type="number"
                min="0"
                max="[[item.quantity]]"
                value="{{quanta}}"
                invalid="{{valid}}">
            </paper-input>
        </paper-card>
        <!--path="udata.cart.[[udata.storeId]].[[item.id]]" udata="{{udata}}-->
        <!--<paper-textarea label="Food Card [[item.id]] Data" value="[[parseJson(item.id, quanta, storeId, userId, item)]]"></paper-textarea>-->
    </template>
    <script>
        Polymer({
            is: 'food-card',
            properties: {
                quanta: {
                    type: Number,
                    observer: "quantaChanged"
                }, valid: {
                    type: Boolean,
                    observer: "validityChanged"
                }
            },
            listeners: {
                "change": "notifyGrid"
            },
            notifyGrid: function() {
                this.fire('foodQuantaChanged', {foodId: this.item.id});
            },
            quantaChanged: function(q) {
                if(this.cart && parseInt(q, 10) === 0)
                    this.customStyle['--show-food-card'] = 'none';
                else
                    this.customStyle['--show-food-card'] = 'inline-block';
                this.updateStyles();
            },
            validityChanged: function (data) {
                if(this.item && parseInt(this.quanta, 10) >= this.item.quantity)
                    this.set("quanta", this.item.quantity);
                else this.set("quanta", 0);
            },
            capitalize: function (str) {
                return capStr(str);
            },
            getObjectKeys: function (items) {
                return getObjKeys(items);
            },
            getObjectValues: function (items) {
                return getObjVals(items);
            },
            parseJson: function () {
                var items = [].slice.apply(arguments);
                return items.reduce(function(acc, item) {
                    return acc + "\nObject\n" + JSON.stringify(item, null, 4);
                }, "");
            }
        });

        function parseJson() {
            var items = [].slice.apply(arguments);
            return items.reduce(function(acc, item) {
                return acc + "\nObject\n" + JSON.stringify(item, null, 4);
            }, "");
        }
    </script>
</dom-module>